{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\hp\\\\OneDrive\\\\Desktop\\\\Rental-Connect Full\\\\Rental-Connect\\\\frontend\\\\src\\\\pages\\\\Messaging.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from \"react\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API = process.env.REACT_APP_API_URL || \"http://localhost:1629/api\";\nexport default function Messaging({\n  chatWithUserId,\n  chatWithUserName\n}) {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [user, setUser] = useState(null);\n  const messagesEndRef = useRef(null);\n  useEffect(() => {\n    // get logged-in user\n    axios.get(`${API}/auth/profile`, {\n      withCredentials: true\n    }).then(res => setUser(res.data)).catch(err => console.error(err));\n  }, []);\n  useEffect(() => {\n    if (!chatWithUserId) return;\n    const fetchMessages = async () => {\n      try {\n        const res = await axios.get(`${API}/messages/${chatWithUserId}`, {\n          withCredentials: true\n        });\n        setMessages(res.data);\n      } catch (err) {\n        console.error(\"Fetch messages error:\", err);\n      }\n    };\n    fetchMessages();\n    const interval = setInterval(fetchMessages, 3000);\n    return () => clearInterval(interval);\n  }, [chatWithUserId]);\n  const handleSend = async () => {\n    if (!chatWithUserId || !newMessage.trim()) {\n      alert(\"Please select a user and type a message.\");\n      return;\n    }\n    try {\n      const response = await axios.post(`${API}/messages`, {\n        to: chatWithUserId,\n        content: newMessage\n      }, {\n        withCredentials: true\n      });\n      console.log(\"Sent message:\", response.data);\n      setMessages(prev => [...prev, response.data]);\n      setNewMessage(\"\");\n    } catch (err) {\n      console.error(\"Send message error:\", err);\n    }\n  };\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  if (!user) return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Loading...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 21\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      maxWidth: \"600px\",\n      margin: \"0 auto\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: [\"Chat with \", chatWithUserName]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        border: \"1px solid #ccc\",\n        borderRadius: \"8px\",\n        height: \"400px\",\n        overflowY: \"auto\",\n        padding: \"10px\",\n        marginBottom: \"10px\"\n      },\n      children: [messages.map(m => /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          margin: \"5px 0\",\n          textAlign: m.sender === user._id ? \"right\" : \"left\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            background: m.sender === user._id ? \"#D1F2EB\" : \"#FADBD8\",\n            padding: \"6px 10px\",\n            borderRadius: \"10px\",\n            display: \"inline-block\"\n          },\n          children: m.content\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 13\n        }, this)\n      }, m._id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: messagesEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: newMessage,\n        onChange: e => setNewMessage(e.target.value),\n        style: {\n          flex: 1,\n          padding: \"8px\",\n          borderRadius: \"6px\",\n          border: \"1px solid #ccc\"\n        },\n        placeholder: \"Type a message...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSend,\n        style: {\n          marginLeft: \"8px\",\n          padding: \"8px 12px\",\n          borderRadius: \"6px\",\n          background: \"#2C3E50\",\n          color: \"#fff\",\n          border: \"none\"\n        },\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n}\n_s(Messaging, \"qc6zjXLdb3WR4fKjyBHqh26xAaA=\");\n_c = Messaging;\nvar _c;\n$RefreshReg$(_c, \"Messaging\");","map":{"version":3,"names":["React","useEffect","useState","useRef","axios","jsxDEV","_jsxDEV","API","process","env","REACT_APP_API_URL","Messaging","chatWithUserId","chatWithUserName","_s","messages","setMessages","newMessage","setNewMessage","user","setUser","messagesEndRef","get","withCredentials","then","res","data","catch","err","console","error","fetchMessages","interval","setInterval","clearInterval","handleSend","trim","alert","response","post","to","content","log","prev","_messagesEndRef$curre","current","scrollIntoView","behavior","children","fileName","_jsxFileName","lineNumber","columnNumber","style","maxWidth","margin","border","borderRadius","height","overflowY","padding","marginBottom","map","m","textAlign","sender","_id","background","display","ref","type","value","onChange","e","target","flex","placeholder","onClick","marginLeft","color","_c","$RefreshReg$"],"sources":["C:/Users/hp/OneDrive/Desktop/Rental-Connect Full/Rental-Connect/frontend/src/pages/Messaging.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nconst API = process.env.REACT_APP_API_URL || \"http://localhost:1629/api\";\r\n\r\nexport default function Messaging({ chatWithUserId, chatWithUserName }) {\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState(\"\");\r\n  const [user, setUser] = useState(null);\r\n  const messagesEndRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    // get logged-in user\r\n    axios.get(`${API}/auth/profile`, { withCredentials: true })\r\n      .then(res => setUser(res.data))\r\n      .catch(err => console.error(err));\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!chatWithUserId) return;\r\n\r\n    const fetchMessages = async () => {\r\n      try {\r\n        const res = await axios.get(`${API}/messages/${chatWithUserId}`, { withCredentials: true });\r\n        setMessages(res.data);\r\n      } catch (err) {\r\n        console.error(\"Fetch messages error:\", err);\r\n      }\r\n    };\r\n\r\n    fetchMessages();\r\n    const interval = setInterval(fetchMessages, 3000);\r\n    return () => clearInterval(interval);\r\n  }, [chatWithUserId]);\r\n\r\n  const handleSend = async () => {\r\n     if (!chatWithUserId || !newMessage.trim()) {\r\n    alert(\"Please select a user and type a message.\");\r\n    return;\r\n  }\r\n  try {\r\n    const response = await axios.post(\r\n      `${API}/messages`,\r\n      {\r\n        to: chatWithUserId,\r\n        content: newMessage,\r\n      },\r\n      { withCredentials: true }\r\n    );\r\n\r\n      console.log(\"Sent message:\", response.data);\r\n      setMessages(prev => [...prev, response.data]);\r\n      setNewMessage(\"\");\r\n    } catch (err) {\r\n      console.error(\"Send message error:\", err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  if (!user) return <p>Loading...</p>;\r\n\r\n  return (\r\n    <div style={{ maxWidth: \"600px\", margin: \"0 auto\" }}>\r\n      <h3>Chat with {chatWithUserName}</h3>\r\n      <div style={{ border: \"1px solid #ccc\", borderRadius: \"8px\", height: \"400px\", overflowY: \"auto\", padding: \"10px\", marginBottom: \"10px\" }}>\r\n        {messages.map((m) => (\r\n          <div key={m._id} style={{ margin: \"5px 0\", textAlign: m.sender === user._id ? \"right\" : \"left\" }}>\r\n            <span style={{ background: m.sender === user._id ? \"#D1F2EB\" : \"#FADBD8\", padding: \"6px 10px\", borderRadius: \"10px\", display: \"inline-block\" }}>\r\n              {m.content}\r\n            </span>\r\n          </div>\r\n        ))}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n      <div style={{ display: \"flex\" }}>\r\n        <input\r\n          type=\"text\"\r\n          value={newMessage}\r\n          onChange={(e) => setNewMessage(e.target.value)}\r\n          style={{ flex: 1, padding: \"8px\", borderRadius: \"6px\", border: \"1px solid #ccc\" }}\r\n          placeholder=\"Type a message...\"\r\n        />\r\n        <button\r\n          onClick={handleSend}\r\n          style={{ marginLeft: \"8px\", padding: \"8px 12px\", borderRadius: \"6px\", background: \"#2C3E50\", color: \"#fff\", border: \"none\" }}\r\n        >\r\n          Send\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}